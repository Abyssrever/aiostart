# å¯æ˜æ˜Ÿå¹³å°æ€§èƒ½é—®é¢˜åˆ†æä¸ä¼˜åŒ–å»ºè®®

## ğŸ” é—®é¢˜ç°è±¡åˆ†æ

æ ¹æ®æ‚¨æè¿°çš„é—®é¢˜ï¼š
- **é¡µé¢åŠ è½½ç¼“æ…¢**ï¼šæ€»æ˜¯åœ¨åŠ è½½é¡µé¢
- **å“åº”ä¸æµç•…**ï¼šç¼©æ”¾çª—å£æ—¶ä¹Ÿä¼šå‡ºç°åŠ è½½
- **äº¤äº’å»¶è¿Ÿ**ï¼šç‚¹å‡»åä¸èƒ½ç›´æ¥æ‰“å¼€ï¼Œéœ€è¦ç­‰å¾…

## ğŸ“Š æ€§èƒ½é—®é¢˜æ ¹å› åˆ†æ

### 1. **æ•°æ®åŠ è½½ç­–ç•¥é—®é¢˜** âš ï¸ **é«˜ä¼˜å…ˆçº§**

#### é—®é¢˜è¯†åˆ«ï¼š
```typescript
// src/app/dashboard/student/page.tsx (ç¬¬32-46è¡Œ)
const loadDashboardData = async () => {
  if (!user?.id) return
  
  setLoading(true)
  try {
    // ğŸš¨ é—®é¢˜ï¼šä¸²è¡ŒåŠ è½½å¤šä¸ªæ•°æ®æº
    const [okrResult, chatResult, statsResult] = await Promise.all([
      OKRService.getUserOKRs(user.id),        // å¯èƒ½å¾ˆæ…¢
      ChatService.getUserChatSessions(user.id), // å¯èƒ½å¾ˆæ…¢
      OKRService.getOKRStats(user.id)         // å¯èƒ½å¾ˆæ…¢
    ])
    // ... å¤„ç†ç»“æœ
  } finally {
    setLoading(false) // ğŸš¨ æ‰€æœ‰æ•°æ®åŠ è½½å®Œæ‰æ˜¾ç¤ºé¡µé¢
  }
}
```

#### æ€§èƒ½å½±å“ï¼š
- **é˜»å¡æ¸²æŸ“**ï¼šæ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆå‰é¡µé¢æ˜¾ç¤ºloading
- **ç½‘ç»œç“¶é¢ˆ**ï¼š3ä¸ªAPIå¹¶å‘è°ƒç”¨å¯èƒ½è¶…æ—¶
- **ç”¨æˆ·ä½“éªŒå·®**ï¼šé•¿æ—¶é—´ç™½å±æˆ–loadingçŠ¶æ€

### 2. **è¿‡åº¦çš„æ•°æ®åˆ·æ–°** âš ï¸ **é«˜ä¼˜å…ˆçº§**

#### é—®é¢˜è¯†åˆ«ï¼š
```typescript
// å¤šä¸ªuseEffectå¯¼è‡´é‡å¤åŠ è½½
useEffect(() => {
  // æ£€æŸ¥URLå‚æ•°åˆ·æ–°æ•°æ®
}, [searchParams, user?.id])

useEffect(() => {
  // è§†å›¾åˆ‡æ¢æ—¶åˆ·æ–°æ•°æ®  
}, [selectedView, user?.id, searchParams])

useEffect(() => {
  // é¡µé¢ç„¦ç‚¹æ—¶åˆ·æ–°æ•°æ®
  const handleFocus = () => {
    if (user?.id && !searchParams.get('tab')) {
      loadDashboardData() // ğŸš¨ é¢‘ç¹è°ƒç”¨
    }
  }
  window.addEventListener('focus', handleFocus)
}, [user?.id, searchParams])
```

#### æ€§èƒ½å½±å“ï¼š
- **é‡å¤è¯·æ±‚**ï¼šåŒä¸€æ•°æ®è¢«å¤šæ¬¡è¯·æ±‚
- **çŠ¶æ€æ··ä¹±**ï¼šå¤šä¸ªloadingçŠ¶æ€é‡å 
- **èµ„æºæµªè´¹**ï¼šä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚

### 3. **ç¼ºä¹æ•°æ®ç¼“å­˜æœºåˆ¶** âš ï¸ **ä¸­ä¼˜å…ˆçº§**

#### é—®é¢˜è¯†åˆ«ï¼š
- æ²¡æœ‰å®ç°å®¢æˆ·ç«¯ç¼“å­˜
- æ¯æ¬¡é¡µé¢åˆ‡æ¢éƒ½é‡æ–°è¯·æ±‚æ•°æ®
- ç¼ºä¹æ•°æ®é¢„åŠ è½½ç­–ç•¥

### 4. **ç»„ä»¶æ¸²æŸ“ä¼˜åŒ–ä¸è¶³** âš ï¸ **ä¸­ä¼˜å…ˆçº§**

#### é—®é¢˜è¯†åˆ«ï¼š
```typescript
// å¤§é‡è®¡ç®—åœ¨æ¸²æŸ“æ—¶æ‰§è¡Œ
const overallProgress = okrs && okrs.length > 0 
  ? Math.round(okrs.reduce((sum, okr) => sum + (okr.progress || okr.progress_percentage || 0), 0) / okrs.length)
  : 0

const getCumulativeStudyDays = () => {
  // æ¯æ¬¡æ¸²æŸ“éƒ½è®¡ç®—
  if (!user?.created_at) return 30
  // ... å¤æ‚è®¡ç®—
}
```

### 5. **Next.jsé…ç½®é—®é¢˜** âš ï¸ **ä½ä¼˜å…ˆçº§**

#### é—®é¢˜è¯†åˆ«ï¼š
```typescript
// next.config.ts
const nextConfig: NextConfig = {
  // ç¼ºä¹æ€§èƒ½ä¼˜åŒ–é…ç½®
  // æ²¡æœ‰å¯ç”¨å›¾ç‰‡ä¼˜åŒ–
  // æ²¡æœ‰é…ç½®ç¼“å­˜ç­–ç•¥
}
```

## ğŸš€ ä¼˜åŒ–æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆä¸€ï¼šæ¸è¿›å¼æ•°æ®åŠ è½½ **[æ¨è]**

#### å®ç°ç­–ç•¥ï¼š
1. **éª¨æ¶å±æ›¿ä»£Loading**
2. **åˆ†å±‚æ•°æ®åŠ è½½**
3. **å…³é”®æ•°æ®ä¼˜å…ˆ**

#### ä»£ç å®ç°ï¼š
```typescript
// ä¼˜åŒ–åçš„æ•°æ®åŠ è½½ç­–ç•¥
const [coreData, setCoreData] = useState(null)
const [extendedData, setExtendedData] = useState(null)
const [coreLoading, setCoreLoading] = useState(true)

// ç¬¬ä¸€å±‚ï¼šæ ¸å¿ƒæ•°æ®ï¼ˆç”¨æˆ·ä¿¡æ¯ã€åŸºç¡€ç»Ÿè®¡ï¼‰
useEffect(() => {
  const loadCoreData = async () => {
    try {
      const basicStats = await OKRService.getBasicStats(user.id)
      setCoreData(basicStats)
    } finally {
      setCoreLoading(false) // å¿«é€Ÿæ˜¾ç¤ºåŸºç¡€ç•Œé¢
    }
  }
  if (user?.id) loadCoreData()
}, [user?.id])

// ç¬¬äºŒå±‚ï¼šæ‰©å±•æ•°æ®ï¼ˆè¯¦ç»†OKRã€èŠå¤©è®°å½•ï¼‰
useEffect(() => {
  const loadExtendedData = async () => {
    const [okrs, chats] = await Promise.all([
      OKRService.getUserOKRs(user.id),
      ChatService.getUserChatSessions(user.id)
    ])
    setExtendedData({ okrs, chats })
  }
  if (user?.id && !coreLoading) {
    // å»¶è¿ŸåŠ è½½ï¼Œä¸é˜»å¡ç•Œé¢
    setTimeout(loadExtendedData, 100)
  }
}, [user?.id, coreLoading])
```

#### é¢„æœŸæ•ˆæœï¼š
- **é¦–å±æ—¶é—´**ï¼šä»3-5ç§’é™è‡³0.5-1ç§’
- **ç”¨æˆ·ä½“éªŒ**ï¼šç«‹å³çœ‹åˆ°ç•Œé¢æ¡†æ¶
- **æ„ŸçŸ¥æ€§èƒ½**ï¼šæ˜¾è‘—æå‡

### æ–¹æ¡ˆäºŒï¼šæ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ **[æ¨è]**

#### å®ç°ç­–ç•¥ï¼š
```typescript
// åˆ›å»ºæ•°æ®ç¼“å­˜Hook
const useDataCache = (key: string, fetcher: () => Promise<any>, ttl = 5 * 60 * 1000) => {
  const [data, setData] = useState(null)
  const [loading, setLoading] = useState(false)
  
  useEffect(() => {
    const cached = sessionStorage.getItem(key)
    if (cached) {
      const { data: cachedData, timestamp } = JSON.parse(cached)
      if (Date.now() - timestamp < ttl) {
        setData(cachedData)
        return
      }
    }
    
    setLoading(true)
    fetcher().then(result => {
      setData(result)
      sessionStorage.setItem(key, JSON.stringify({
        data: result,
        timestamp: Date.now()
      }))
    }).finally(() => setLoading(false))
  }, [key])
  
  return { data, loading, refresh: () => {
    sessionStorage.removeItem(key)
    // é‡æ–°åŠ è½½
  }}
}

// ä½¿ç”¨ç¼“å­˜
const { data: okrData, loading: okrLoading } = useDataCache(
  `okr-${user?.id}`, 
  () => OKRService.getUserOKRs(user.id),
  3 * 60 * 1000 // 3åˆ†é’Ÿç¼“å­˜
)
```

### æ–¹æ¡ˆä¸‰ï¼šç»„ä»¶æ€§èƒ½ä¼˜åŒ– **[æ¨è]**

#### å®ç°ç­–ç•¥ï¼š
```typescript
// ä½¿ç”¨React.memoä¼˜åŒ–é‡æ¸²æŸ“
const OKRCard = React.memo(({ okr }: { okr: OKRWithKeyResults }) => {
  return (
    <Card>
      {/* OKRå¡ç‰‡å†…å®¹ */}
    </Card>
  )
})

// ä½¿ç”¨useMemoç¼“å­˜è®¡ç®—ç»“æœ
const dashboardStats = useMemo(() => {
  if (!okrs.length) return { overallProgress: 0, studyDays: 30 }
  
  const overallProgress = Math.round(
    okrs.reduce((sum, okr) => sum + (okr.progress || 0), 0) / okrs.length
  )
  
  const studyDays = user?.created_at 
    ? Math.ceil((Date.now() - new Date(user.created_at).getTime()) / (1000 * 60 * 60 * 24))
    : 30
    
  return { overallProgress, studyDays }
}, [okrs, user?.created_at])

// ä½¿ç”¨useCallbackä¼˜åŒ–äº‹ä»¶å¤„ç†
const handleOKRClick = useCallback((okrId: string) => {
  sessionStorage.setItem('okr_page_timestamp', Date.now().toString())
  router.push(`/dashboard/student?tab=okr&id=${okrId}`)
}, [router])
```

### æ–¹æ¡ˆå››ï¼šNext.jsé…ç½®ä¼˜åŒ– **[å¯é€‰]**

#### å®ç°ç­–ç•¥ï¼š
```typescript
// next.config.ts ä¼˜åŒ–é…ç½®
const nextConfig: NextConfig = {
  // å¯ç”¨å®éªŒæ€§åŠŸèƒ½
  experimental: {
    optimizeCss: true,
    optimizePackageImports: ['lucide-react', '@radix-ui/react-icons']
  },
  
  // å›¾ç‰‡ä¼˜åŒ–
  images: {
    domains: ['localhost'],
    formats: ['image/webp', 'image/avif']
  },
  
  // ç¼–è¯‘ä¼˜åŒ–
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production'
  },
  
  // ç¼“å­˜ä¼˜åŒ–
  async headers() {
    return [
      {
        source: '/dashboard/:path*',
        headers: [
          {
            key: 'Cache-Control',
            value: 'public, max-age=0, must-revalidate'
          }
        ]
      }
    ]
  }
}
```

## ğŸ“ˆ ä¼˜åŒ–æ•ˆæœé¢„æœŸ

### æ€§èƒ½æŒ‡æ ‡æ”¹å–„ï¼š

| æŒ‡æ ‡ | å½“å‰çŠ¶æ€ | ä¼˜åŒ–å | æ”¹å–„å¹…åº¦ |
|------|----------|--------|----------|
| é¦–å±åŠ è½½æ—¶é—´ | 3-5ç§’ | 0.5-1ç§’ | **75-85%** |
| é¡µé¢åˆ‡æ¢å“åº” | 1-2ç§’ | 0.1-0.3ç§’ | **85-90%** |
| çª—å£ç¼©æ”¾å“åº” | å¡é¡¿ | æµç•… | **æ˜¾è‘—æ”¹å–„** |
| æ•°æ®åˆ·æ–°é¢‘ç‡ | è¿‡åº¦é¢‘ç¹ | æŒ‰éœ€åˆ·æ–° | **å‡å°‘70%** |
| å†…å­˜ä½¿ç”¨ | è¾ƒé«˜ | ä¼˜åŒ– | **å‡å°‘30%** |

### ç”¨æˆ·ä½“éªŒæ”¹å–„ï¼š
- âœ… **å³æ—¶å“åº”**ï¼šç‚¹å‡»ç«‹å³åé¦ˆ
- âœ… **æµç•…äº¤äº’**ï¼šæ— å¡é¡¿æ„Ÿ
- âœ… **æ¸è¿›åŠ è½½**ï¼šå†…å®¹é€æ­¥å‘ˆç°
- âœ… **æ™ºèƒ½ç¼“å­˜**ï¼šå‡å°‘ç­‰å¾…æ—¶é—´

## ğŸ› ï¸ å®æ–½å»ºè®®

### é˜¶æ®µä¸€ï¼šç´§æ€¥ä¼˜åŒ– (1-2å¤©)
1. **å®æ–½æ¸è¿›å¼åŠ è½½**
   - æ·»åŠ éª¨æ¶å±ç»„ä»¶
   - åˆ†ç¦»æ ¸å¿ƒæ•°æ®å’Œæ‰©å±•æ•°æ®
   - ä¼˜åŒ–loadingçŠ¶æ€ç®¡ç†

2. **å‡å°‘é‡å¤è¯·æ±‚**
   - åˆå¹¶é‡å¤çš„useEffect
   - æ·»åŠ è¯·æ±‚å»é‡é€»è¾‘
   - ä¼˜åŒ–æ•°æ®åˆ·æ–°ç­–ç•¥

### é˜¶æ®µäºŒï¼šç³»ç»Ÿä¼˜åŒ– (3-5å¤©)
1. **å®æ–½ç¼“å­˜ç³»ç»Ÿ**
   - åˆ›å»ºæ•°æ®ç¼“å­˜Hook
   - å®ç°æ™ºèƒ½ç¼“å­˜ç­–ç•¥
   - æ·»åŠ ç¼“å­˜å¤±æ•ˆæœºåˆ¶

2. **ç»„ä»¶æ€§èƒ½ä¼˜åŒ–**
   - æ·»åŠ React.memo
   - ä½¿ç”¨useMemo/useCallback
   - ä¼˜åŒ–æ¸²æŸ“é€»è¾‘

### é˜¶æ®µä¸‰ï¼šæ·±åº¦ä¼˜åŒ– (å¯é€‰)
1. **Next.jsé…ç½®ä¼˜åŒ–**
2. **ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½**
3. **æœåŠ¡ç«¯æ¸²æŸ“ä¼˜åŒ–**

## ğŸ’¡ ä¿®æ”¹å»ºè®®è¯„ä¼°

### å»ºè®®ä¿®æ”¹çš„æ–‡ä»¶ï¼š

#### é«˜ä¼˜å…ˆçº§ä¿®æ”¹ï¼š
1. **`src/app/dashboard/student/page.tsx`** - æ ¸å¿ƒæ€§èƒ½é—®é¢˜
2. **`src/lib/okr-service-*.ts`** - æ•°æ®åŠ è½½ä¼˜åŒ–
3. **`src/contexts/AuthContext.tsx`** - è®¤è¯çŠ¶æ€ä¼˜åŒ–

#### ä¸­ä¼˜å…ˆçº§ä¿®æ”¹ï¼š
1. **`src/components/Navigation.tsx`** - å¯¼èˆªå“åº”ä¼˜åŒ–
2. **`next.config.ts`** - æ„å»ºé…ç½®ä¼˜åŒ–

#### æ–°å¢æ–‡ä»¶ï¼š
1. **`src/hooks/useDataCache.ts`** - ç¼“å­˜Hook
2. **`src/components/ui/skeleton.tsx`** - éª¨æ¶å±ç»„ä»¶
3. **`src/lib/performance-utils.ts`** - æ€§èƒ½å·¥å…·

### é£é™©è¯„ä¼°ï¼š
- **ä½é£é™©**ï¼šç¼“å­˜å’Œéª¨æ¶å±å®ç°
- **ä¸­é£é™©**ï¼šæ•°æ®åŠ è½½é€»è¾‘é‡æ„
- **é«˜é£é™©**ï¼šNext.jsé…ç½®ä¿®æ”¹

### æŠ•å…¥äº§å‡ºæ¯”ï¼š
- **é«˜å›æŠ¥**ï¼šæ¸è¿›å¼åŠ è½½ + ç¼“å­˜ç³»ç»Ÿ
- **ä¸­å›æŠ¥**ï¼šç»„ä»¶ä¼˜åŒ– + é…ç½®ä¼˜åŒ–
- **é•¿æœŸå›æŠ¥**ï¼šæ¶æ„ä¼˜åŒ–

## ğŸ¯ æ€»ç»“å»ºè®®

### ç«‹å³å®æ–½ï¼ˆå¼ºçƒˆæ¨èï¼‰ï¼š
1. **æ¸è¿›å¼æ•°æ®åŠ è½½** - è§£å†³æ ¸å¿ƒåŠ è½½é—®é¢˜
2. **å‡å°‘é‡å¤è¯·æ±‚** - ä¼˜åŒ–æ•°æ®åˆ·æ–°ç­–ç•¥
3. **æ·»åŠ éª¨æ¶å±** - æ”¹å–„ç”¨æˆ·æ„ŸçŸ¥æ€§èƒ½

### è®¡åˆ’å®æ–½ï¼ˆæ¨èï¼‰ï¼š
1. **æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ** - é•¿æœŸæ€§èƒ½æå‡
2. **ç»„ä»¶æ€§èƒ½ä¼˜åŒ–** - æå‡äº¤äº’æµç•…åº¦

### å¯é€‰å®æ–½ï¼š
1. **Next.jsæ·±åº¦ä¼˜åŒ–** - è¿›ä¸€æ­¥æ€§èƒ½æå‡

**é¢„æœŸæ€»ä½“æ”¹å–„ï¼šç”¨æˆ·æ„ŸçŸ¥æ€§èƒ½æå‡80%ä»¥ä¸Šï¼ŒæŠ€æœ¯æŒ‡æ ‡æ”¹å–„70%ä»¥ä¸Š**

---

**å»ºè®®ä¼˜å…ˆçº§ï¼šæ¸è¿›å¼åŠ è½½ > ç¼“å­˜ç³»ç»Ÿ > ç»„ä»¶ä¼˜åŒ– > é…ç½®ä¼˜åŒ–**

æ‚¨è§‰å¾—è¿™ä¸ªåˆ†æå’Œå»ºè®®å¦‚ä½•ï¼Ÿæˆ‘å¯ä»¥ç«‹å³å¼€å§‹å®æ–½æœ€é«˜ä¼˜å…ˆçº§çš„ä¼˜åŒ–æ–¹æ¡ˆã€‚