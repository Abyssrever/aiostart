
> qiming-star-prototype@0.1.0 dev
> next dev

 ⚠ Port 3000 is in use by process 13528, using available port 3001 instead.
   ▲ Next.js 15.5.0
   - Local:        http://localhost:3001
   - Network:      http://192.168.146.13:3001
   - Environments: .env.local

 ✓ Starting...
 ✓ Ready in 3.6s
 ○ Compiling /api/ai-chat ...
 ✓ Compiled /api/ai-chat in 986ms (299 modules)
🌍 环境变量调试: { AI_PROVIDER: 'n8n', AI_WEBHOOK_URL: '已配置', AI_TIMEOUT: '30000' }
🚀 AI Chat API 被调用
📤 收到请求: { message: '����AI��Ӧ', sessionType: 'general' }
🔧 AI服务管理器初始化配置: {
  provider: 'n8n',
  webhookUrl: '已配置',
  hasApiKey: false,
  timeout: 30000
}
🚀 调用N8N工作流: https://n8n-vdarinvh.us-east-1.clawcloudrun.com/webhook/21e98a9d-e00b-42e7-a224-37c14f335815
📤 请求数据: {
  userMessage: '����AI��Ӧ',
  userId: undefined,
  sessionId: undefined,
  sessionType: 'general',
  userProfile: undefined,
  conversationHistory: [],
  metadata: { platform: 'qiming-star', timestamp: '2025-08-27T12:29:25.195Z' }
}
📊 N8N响应状态: 200
📥 N8N响应数据: { responds: '{{json.output}}' }
🔍 解析N8N响应: { responds: '{{json.output}}' }
✅ 解析出的AI回复: 抱歉，AI服务暂时不可用，请稍后再试。
✅ AI响应成功: 抱歉，AI服务暂时不可用，请稍后再试。
 POST /api/ai-chat 200 in 10702ms
 ✓ Compiled in 245ms (104 modules)
 ○ Compiling /_not-found ...
 ✓ Compiled /_not-found in 973ms (716 modules)
 POST /api/ai-chat 404 in 1429ms
🌍 环境变量调试: { AI_PROVIDER: 'n8n', AI_WEBHOOK_URL: '已配置', AI_TIMEOUT: '30000' }
🚀 AI Chat API 被调用
📤 收到请求: { message: 'Hello', sessionType: 'general' }
🔧 AI服务管理器初始化配置: {
  provider: 'n8n',
  webhookUrl: '已配置',
  hasApiKey: false,
  timeout: 30000
}
🚀 调用N8N工作流: https://n8n-vdarinvh.us-east-1.clawcloudrun.com/webhook/21e98a9d-e00b-42e7-a224-37c14f335815
📤 请求数据: {
  userMessage: 'Hello',
  userId: undefined,
  sessionId: undefined,
  sessionType: 'general',
  userProfile: undefined,
  conversationHistory: [],
  metadata: { platform: 'qiming-star', timestamp: '2025-08-27T12:37:07.684Z' }
}
📊 N8N响应状态: 200
N8N webhook调用异常: SyntaxError: Unexpected end of JSON input
    at JSON.parse (<anonymous>)
    at async AIServiceManager.callN8nWebhook (src\lib\ai-service-manager.ts:116:20)
    at async AIServiceManager.sendAIRequest (src\lib\ai-service-manager.ts:48:22)
    at async POST (src\app\api\ai-chat\route.ts:26:24)
  114 |       }
  115 |
> 116 |       const data = await response.json()
      |                    ^
  117 |       console.log('📥 N8N响应数据:', data)
  118 |       
  119 |       return this.parseN8nResponse(data)
AI服务请求失败: SyntaxError: Unexpected end of JSON input
    at JSON.parse (<anonymous>)
    at async AIServiceManager.callN8nWebhook (src\lib\ai-service-manager.ts:116:20)
    at async AIServiceManager.sendAIRequest (src\lib\ai-service-manager.ts:48:22)
    at async POST (src\app\api\ai-chat\route.ts:26:24)
  114 |       }
  115 |
> 116 |       const data = await response.json()
      |                    ^
  117 |       console.log('📥 N8N响应数据:', data)
  118 |       
  119 |       return this.parseN8nResponse(data)
❌ AI Chat API 错误: SyntaxError: Unexpected end of JSON input
    at JSON.parse (<anonymous>)
    at async AIServiceManager.callN8nWebhook (src\lib\ai-service-manager.ts:116:20)
    at async AIServiceManager.sendAIRequest (src\lib\ai-service-manager.ts:48:22)
    at async POST (src\app\api\ai-chat\route.ts:26:24)
  114 |       }
  115 |
> 116 |       const data = await response.json()
      |                    ^
  117 |       console.log('📥 N8N响应数据:', data)
  118 |       
  119 |       return this.parseN8nResponse(data)
 POST /api/ai-chat 500 in 7647ms
 ✓ Compiled in 1769ms (412 modules)
🌍 环境变量调试: { AI_PROVIDER: 'n8n', AI_WEBHOOK_URL: '已配置', AI_TIMEOUT: '30000' }
🚀 AI Chat API 被调用
📤 收到请求: { message: '���', sessionType: 'general' }
🔧 AI服务管理器初始化配置: {
  provider: 'n8n',
  webhookUrl: '已配置',
  hasApiKey: false,
  timeout: 30000
}
🚀 调用N8N工作流: https://n8n-vdarinvh.us-east-1.clawcloudrun.com/webhook/21e98a9d-e00b-42e7-a224-37c14f335815
📤 请求数据: {
  userMessage: '���',
  userId: undefined,
  sessionId: undefined,
  sessionType: 'general',
  userProfile: undefined,
  conversationHistory: [],
  metadata: { platform: 'qiming-star', timestamp: '2025-08-27T12:37:42.479Z' }
}
📊 N8N响应状态: 200
📥 N8N原始响应: 
⚠️ N8N响应不是JSON格式，直接使用文本内容
🔍 解析N8N响应: { response: '' }
✅ 解析出的AI回复: 抱歉，AI服务暂时不可用，请稍后再试。
✅ AI响应成功: 抱歉，AI服务暂时不可用，请稍后再试。
 POST /api/ai-chat 200 in 10779ms
 GET /api/ai-chat 405 in 27ms
 ✓ Compiled / in 298ms (720 modules)
 GET / 200 in 628ms
 ○ Compiling /login ...
 ✓ Compiled /login in 550ms (770 modules)
 GET /login 200 in 721ms
 ○ Compiling /dashboard/student ...
 ✓ Compiled /dashboard/student in 628ms (1026 modules)
 GET /dashboard/student 200 in 730ms
🌍 环境变量调试: { AI_PROVIDER: 'n8n', AI_WEBHOOK_URL: '已配置', AI_TIMEOUT: '30000' }
🚀 AI Chat API 被调用
📤 收到请求: { message: '你好', sessionType: 'general' }
🔧 AI服务管理器初始化配置: {
  provider: 'n8n',
  webhookUrl: '已配置',
  hasApiKey: false,
  timeout: 30000
}
🚀 调用N8N工作流: https://n8n-vdarinvh.us-east-1.clawcloudrun.com/webhook/21e98a9d-e00b-42e7-a224-37c14f335815
📤 请求数据: {
  userMessage: '你好',
  userId: undefined,
  sessionId: undefined,
  sessionType: 'general',
  userProfile: undefined,
  conversationHistory: [],
  metadata: { platform: 'qiming-star', timestamp: '2025-08-27T12:39:56.236Z' }
}
📊 N8N响应状态: 200
📥 N8N原始响应: 
⚠️ N8N响应不是JSON格式，直接使用文本内容
🔍 解析N8N响应: { response: '' }
✅ 解析出的AI回复: 抱歉，AI服务暂时不可用，请稍后再试。
✅ AI响应成功: 抱歉，AI服务暂时不可用，请稍后再试。
 POST /api/ai-chat 200 in 5668ms
 GET /dashboard/student 200 in 252ms
 GET /dashboard/student 200 in 56ms
 GET / 200 in 49ms
 GET /login 200 in 50ms
 GET /dashboard/student 200 in 27ms
🚀 AI Chat API 被调用
📤 收到请求: { message: '23', sessionType: 'general' }
🚀 调用N8N工作流: https://n8n-vdarinvh.us-east-1.clawcloudrun.com/webhook/21e98a9d-e00b-42e7-a224-37c14f335815
📤 请求数据: {
  userMessage: '23',
  userId: undefined,
  sessionId: undefined,
  sessionType: 'general',
  userProfile: undefined,
  conversationHistory: [],
  metadata: { platform: 'qiming-star', timestamp: '2025-08-27T12:42:53.351Z' }
}
📊 N8N响应状态: 200
📥 N8N原始响应: 
⚠️ N8N响应不是JSON格式，直接使用文本内容
🔍 解析N8N响应: { response: '' }
✅ 解析出的AI回复: 抱歉，AI服务暂时不可用，请稍后再试。
✅ AI响应成功: 抱歉，AI服务暂时不可用，请稍后再试。
 POST /api/ai-chat 200 in 9432ms
 GET /dashboard/student 200 in 66ms
 ○ Compiling /dashboard ...
 ✓ Compiled /dashboard in 507ms (1007 modules)
 GET /dashboard 200 in 816ms
 GET /login 200 in 36ms
 GET /dashboard/student 200 in 46ms
 ✓ Compiled /api/ai-chat in 221ms (576 modules)
🌍 环境变量调试: { AI_PROVIDER: 'n8n', AI_WEBHOOK_URL: '已配置', AI_TIMEOUT: '30000' }
🚀 AI Chat API 被调用
📤 收到请求: { message: '你好呀', sessionType: 'general' }
🔧 AI服务管理器初始化配置: {
  provider: 'n8n',
  webhookUrl: '已配置',
  hasApiKey: false,
  timeout: 30000
}
🚀 调用N8N工作流: https://n8n-vdarinvh.us-east-1.clawcloudrun.com/webhook/21e98a9d-e00b-42e7-a224-37c14f335815
📤 请求数据: {
  userMessage: '你好呀',
  userId: undefined,
  sessionId: undefined,
  sessionType: 'general',
  userProfile: undefined,
  conversationHistory: [],
  metadata: { platform: 'qiming-star', timestamp: '2025-08-27T12:49:12.390Z' }
}
N8N webhook调用异常: TypeError: fetch failed
    at async AIServiceManager.callN8nWebhook (src\lib\ai-service-manager.ts:96:24)
    at async AIServiceManager.sendAIRequest (src\lib\ai-service-manager.ts:48:22)
    at async POST (src\app\api\ai-chat\route.ts:26:24)
  94 |       console.log('📤 请求数据:', n8nRequest)
  95 |
> 96 |       const response = await fetch(this.config.webhookUrl, {
     |                        ^
  97 |         method: 'POST',
  98 |         headers: {
  99 |           'Content-Type': 'application/json; charset=utf-8', {
  [cause]: [Error [ConnectTimeoutError]: Connect Timeout Error (attempted addresses: 47.89.135.118:443, 47.89.186.110:443, 47.90.209.144:443, 47.253.35.19:443, 47.90.173.78:443, timeout: 10000ms)] {
    code: 'UND_ERR_CONNECT_TIMEOUT'
  }
}
AI服务请求失败: TypeError: fetch failed
    at async AIServiceManager.callN8nWebhook (src\lib\ai-service-manager.ts:96:24)
    at async AIServiceManager.sendAIRequest (src\lib\ai-service-manager.ts:48:22)
    at async POST (src\app\api\ai-chat\route.ts:26:24)
  94 |       console.log('📤 请求数据:', n8nRequest)
  95 |
> 96 |       const response = await fetch(this.config.webhookUrl, {
     |                        ^
  97 |         method: 'POST',
  98 |         headers: {
  99 |           'Content-Type': 'application/json; charset=utf-8', {
  [cause]: [Error [ConnectTimeoutError]: Connect Timeout Error (attempted addresses: 47.89.135.118:443, 47.89.186.110:443, 47.90.209.144:443, 47.253.35.19:443, 47.90.173.78:443, timeout: 10000ms)] {
    code: 'UND_ERR_CONNECT_TIMEOUT'
  }
}
❌ AI Chat API 错误: TypeError: fetch failed
    at async AIServiceManager.callN8nWebhook (src\lib\ai-service-manager.ts:96:24)
    at async AIServiceManager.sendAIRequest (src\lib\ai-service-manager.ts:48:22)
    at async POST (src\app\api\ai-chat\route.ts:26:24)
  94 |       console.log('📤 请求数据:', n8nRequest)
  95 |
> 96 |       const response = await fetch(this.config.webhookUrl, {
     |                        ^
  97 |         method: 'POST',
  98 |         headers: {
  99 |           'Content-Type': 'application/json; charset=utf-8', {
  [cause]: [Error [ConnectTimeoutError]: Connect Timeout Error (attempted addresses: 47.89.135.118:443, 47.89.186.110:443, 47.90.209.144:443, 47.253.35.19:443, 47.90.173.78:443, timeout: 10000ms)] {
    code: 'UND_ERR_CONNECT_TIMEOUT'
  }
}
 POST /api/ai-chat 500 in 11216ms
 GET /dashboard/student?tab=okr 200 in 90ms
 GET /dashboard 200 in 31ms
 GET /dashboard/student 200 in 44ms
 GET /dashboard/student 200 in 31ms
 GET /dashboard 200 in 29ms
 GET /dashboard/student 200 in 38ms
 GET /dashboard/student 200 in 35ms
 GET /dashboard 200 in 31ms
 GET /dashboard/student 200 in 36ms
 GET /dashboard/student 200 in 30ms
 GET /dashboard/student 200 in 264ms
 ✓ Compiled / in 218ms (560 modules)
 GET / 200 in 557ms
 GET /login 200 in 61ms
 GET /login 200 in 85ms
 GET /dashboard/student 200 in 45ms
 ✓ Compiled /api/ai-chat in 245ms (581 modules)
🌍 环境变量调试: { AI_PROVIDER: 'n8n', AI_WEBHOOK_URL: '已配置', AI_TIMEOUT: '30000' }
🚀 AI Chat API 被调用
📤 收到请求: { message: '你好', sessionType: 'general' }
🔧 AI服务管理器初始化配置: {
  provider: 'n8n',
  webhookUrl: '已配置',
  hasApiKey: false,
  timeout: 30000
}
🚀 调用N8N工作流: https://n8n-vdarinvh.us-east-1.clawcloudrun.com/webhook/21e98a9d-e00b-42e7-a224-37c14f335815
📤 请求数据: {
  userMessage: '你好',
  userId: undefined,
  sessionId: undefined,
  sessionType: 'general',
  userProfile: undefined,
  conversationHistory: [],
  metadata: { platform: 'qiming-star', timestamp: '2025-08-27T12:51:35.851Z' }
}
N8N webhook调用异常: TypeError: fetch failed
    at async AIServiceManager.callN8nWebhook (src\lib\ai-service-manager.ts:96:24)
    at async AIServiceManager.sendAIRequest (src\lib\ai-service-manager.ts:48:22)
    at async POST (src\app\api\ai-chat\route.ts:26:24)
  94 |       console.log('📤 请求数据:', n8nRequest)
  95 |
> 96 |       const response = await fetch(this.config.webhookUrl, {
     |                        ^
  97 |         method: 'POST',
  98 |         headers: {
  99 |           'Content-Type': 'application/json; charset=utf-8', {
  [cause]: [Error [ConnectTimeoutError]: Connect Timeout Error (attempted addresses: 47.90.209.144:443, 47.253.35.19:443, 47.89.135.118:443, 47.89.186.110:443, 47.90.173.78:443, timeout: 10000ms)] {
    code: 'UND_ERR_CONNECT_TIMEOUT'
  }
}
AI服务请求失败: TypeError: fetch failed
    at async AIServiceManager.callN8nWebhook (src\lib\ai-service-manager.ts:96:24)
    at async AIServiceManager.sendAIRequest (src\lib\ai-service-manager.ts:48:22)
    at async POST (src\app\api\ai-chat\route.ts:26:24)
  94 |       console.log('📤 请求数据:', n8nRequest)
  95 |
> 96 |       const response = await fetch(this.config.webhookUrl, {
     |                        ^
  97 |         method: 'POST',
  98 |         headers: {
  99 |           'Content-Type': 'application/json; charset=utf-8', {
  [cause]: [Error [ConnectTimeoutError]: Connect Timeout Error (attempted addresses: 47.90.209.144:443, 47.253.35.19:443, 47.89.135.118:443, 47.89.186.110:443, 47.90.173.78:443, timeout: 10000ms)] {
    code: 'UND_ERR_CONNECT_TIMEOUT'
  }
}
❌ AI Chat API 错误: TypeError: fetch failed
    at async AIServiceManager.callN8nWebhook (src\lib\ai-service-manager.ts:96:24)
    at async AIServiceManager.sendAIRequest (src\lib\ai-service-manager.ts:48:22)
    at async POST (src\app\api\ai-chat\route.ts:26:24)
  94 |       console.log('📤 请求数据:', n8nRequest)
  95 |
> 96 |       const response = await fetch(this.config.webhookUrl, {
     |                        ^
  97 |         method: 'POST',
  98 |         headers: {
  99 |           'Content-Type': 'application/json; charset=utf-8', {
  [cause]: [Error [ConnectTimeoutError]: Connect Timeout Error (attempted addresses: 47.90.209.144:443, 47.253.35.19:443, 47.89.135.118:443, 47.89.186.110:443, 47.90.173.78:443, timeout: 10000ms)] {
    code: 'UND_ERR_CONNECT_TIMEOUT'
  }
}
 POST /api/ai-chat 500 in 11253ms
 GET /dashboard 200 in 70ms
 GET /dashboard/student 200 in 61ms
 GET /dashboard/student 200 in 31ms
 GET / 200 in 144ms
 GET /login 200 in 53ms
 GET /dashboard/student 200 in 24ms
🚀 AI Chat API 被调用
📤 收到请求: { message: 'hello', sessionType: 'general' }
🚀 调用N8N工作流: https://n8n-vdarinvh.us-east-1.clawcloudrun.com/webhook/21e98a9d-e00b-42e7-a224-37c14f335815
📤 请求数据: {
  userMessage: 'hello',
  userId: undefined,
  sessionId: undefined,
  sessionType: 'general',
  userProfile: undefined,
  conversationHistory: [],
  metadata: { platform: 'qiming-star', timestamp: '2025-08-27T12:53:20.596Z' }
}
📊 N8N响应状态: 200
📥 N8N原始响应: 
⚠️ N8N响应不是JSON格式，直接使用文本内容
🔍 解析N8N响应: { response: '' }
✅ 解析出的AI回复: 抱歉，AI服务暂时不可用，请稍后再试。
✅ AI响应成功: 抱歉，AI服务暂时不可用，请稍后再试。
 POST /api/ai-chat 200 in 10293ms
 GET / 200 in 56ms
 GET /login 200 in 36ms
 GET /dashboard/student 200 in 25ms
🚀 AI Chat API 被调用
📤 收到请求: { message: 'hello', sessionType: 'general' }
🚀 调用N8N工作流: https://n8n-vdarinvh.us-east-1.clawcloudrun.com/webhook/21e98a9d-e00b-42e7-a224-37c14f335815
📤 请求数据: {
  userMessage: 'hello',
  userId: undefined,
  sessionId: undefined,
  sessionType: 'general',
  userProfile: undefined,
  conversationHistory: [],
  metadata: { platform: 'qiming-star', timestamp: '2025-08-27T12:55:05.194Z' }
}
📊 N8N响应状态: 200
📥 N8N原始响应: 
⚠️ N8N响应不是JSON格式，直接使用文本内容
🔍 解析N8N响应: { response: '' }
✅ 解析出的AI回复: 抱歉，AI服务暂时不可用，请稍后再试。
✅ AI响应成功: 抱歉，AI服务暂时不可用，请稍后再试。
 POST /api/ai-chat 200 in 9797ms
